@model MVCSchooldbDemo.Models.Data.BADLInfo
@{
    Layout = null;
}
<div class="editorTitle">@ViewBag.DialogTitle</div>
<form id="formBADL" method="post" class="easyui-form" data-options="novalidate:true">
    <div id="editorTabs" class="easyui-tabs editorTabs">
        <div title="BADL 评估：Barthel 指数评价表">
            <table class="editorTable">
                <tr>
                    <th colspan="6">BADL 评估：Barthel 指数评价表</th>
                </tr>
                <tr>
                    <th class="editorNameColumnStandard">项目</th>
                    <th colspan="4">评定标准</th>
                    <th class="editorNameColumnStandard">评分</th>
                </tr>
                <tr>
                    <th>1. 大便</th>
                    <td colspan="4">
                        0 = 失禁或昏迷<br/>
                        5 = 偶尔失禁（每周 < 1 次）<br/>
                        10 = 能控制<br/>
                    </td>
                    <td>
                        <select id="Barthel指数评价表_大便" class="easyui-combobox editorInputComboBox"></select>
                    </td>
                </tr>
                <tr>
                    <th>2. 小便</th>
                    <td colspan="4">
                        0 = 失禁或昏迷或需由他人导尿<br/>
                        5 = 偶尔失禁（每 24 小时 < 1 次，每周 > 1 次）<br/>
                        10 = 能控制<br/>
                    </td>
                    <td>
                        <select id="Barthel指数评价表_小便" class="easyui-combobox editorInputComboBox"></select>
                    </td>
                </tr>
                <tr>
                    <th>3. 修饰</th>
                    <td colspan="4">
                        0 = 需帮助<br/>
                        5 = 独立洗脸、梳头、刷牙、剃胡须<br/>
                    </td>
                    <td>
                        <select id="Barthel指数评价表_修饰" class="easyui-combobox editorInputComboBox"></select>
                    </td>
                </tr>
                <tr>
                    <th>4. 用厕</th>
                    <td colspan="4">
                        0 = 依赖别人<br/>
                        5 = 需部分帮助<br/>
                        10 = 自理<br/>
                    </td>
                    <td>
                        <select id="Barthel指数评价表_用厕" class="easyui-combobox editorInputComboBox"></select>
                    </td>
                </tr>
                <tr>
                    <th>5. 进食</th>
                    <td colspan="4">
                        0 = 依赖别人<br/>
                        5 = 需部分帮助（夹菜、盛饭、切面包）<br/>
                        10 = 全面自理<br/>
                    </td>
                    <td>
                        <select id="Barthel指数评价表_进食" class="easyui-combobox editorInputComboBox"></select>
                    </td>
                </tr>
                <tr>
                    <th>6. 转移<br/>（床 → 椅）</th>
                    <td colspan="4">
                        0 = 不能步行<br/>
                        5 = 在轮椅上独立行动<br/>
                        10 = 需 1 人帮助步行（体力或语言指导）<br/>
                        15 = 独立步行（可用辅助器）<br/>
                    </td>
                    <td>
                        <select id="Barthel指数评价表_转移" class="easyui-combobox editorInputComboBox"></select>
                    </td>
                </tr>
                <tr>
                    <th>7. 活动（步行）</th>
                    <td colspan="4">
                        0 = 完全依赖别人，不能坐<br/>
                        5 = 需大量帮助（2 人）能坐<br/>
                        10 = 需少量帮助（1 人）或指导<br/>
                        15 = 自理<br/>
                    </td>
                    <td>
                        <select id="Barthel指数评价表_活动" class="easyui-combobox editorInputComboBox"></select>
                    </td>
                </tr>
                <tr>
                    <th>8. 穿衣</th>
                    <td colspan="4">
                        0 = 依赖别人<br/>
                        5 = 需部分帮助<br/>
                        10 = 自理（系、开钮扣、关、开拉锁和穿鞋）<br/>
                    </td>
                    <td>
                        <select id="Barthel指数评价表_穿衣" class="easyui-combobox editorInputComboBox"></select>
                    </td>
                </tr>
                <tr>
                    <th>9. 上下楼梯</th>
                    <td colspan="4">
                        0 = 不能<br/>
                        5 = 需帮助（体力或语言指导）<br/>
                        10 = 自理<br/>
                    </td>
                    <td>
                        <select id="Barthel指数评价表_上下楼梯" class="easyui-combobox editorInputComboBox"></select>
                    </td>
                </tr>
                <tr>
                    <th>10. 洗澡</th>
                    <td colspan="4">
                        0 = 依赖别人<br/>
                        15 = 自理<br/>
                    </td>
                    <td>
                        <select id="Barthel指数评价表_洗澡" class="easyui-combobox editorInputComboBox"></select>
                    </td>
                </tr>
                <tr>
                    <th>参考</th>
                    <td colspan="4">
                        总分 100 分，＞60 分生活基本自理；40~60 分生活需要部分帮助；20~40 分生活需大部分帮助；20 分 以下生活完全依赖。
                    </td>
                    <th>
                        <span id="Barthel指数评价表_总分"></span>
                    </th>
                </tr>
                <tr>
                    <th class="editorNameColumnStandard">被评估人</th>
                    <td>
                        <select id="Barthel指数评价表_被评估人" class="easyui-combobox editorInputComboBox" data-options="required:true, missingMessage:'请输入被评估人姓名'"></select>
                    </td>
                    <th class="editorNameColumnStandard">评估日期</th>
                    <td>
                        <input id="Barthel指数评价表_评估日期" class="easyui-datebox" data-options="required:true, missingMessage:'请输入评估日期'"/>
                    </td>
                    <th class="editorNameColumnStandard">康复护士</th>
                    <td>
                        <input id="Barthel指数评价表_康复护士" class="easyui-textbox" style="width: 100px" data-options="required:true, missingMessage:'请输入康复护士姓名'"/>
                    </td>
                </tr>
            </table>
        </div>
    </div>
</form>
<script>
    $(function() {
        BindDataDictItemToCombobox("Barthel指数评价表_大便");
        BindDataDictItemToCombobox("Barthel指数评价表_小便");
        BindDataDictItemToCombobox("Barthel指数评价表_修饰");
        BindDataDictItemToCombobox("Barthel指数评价表_用厕");
        BindDataDictItemToCombobox("Barthel指数评价表_进食");
        BindDataDictItemToCombobox("Barthel指数评价表_转移");
        BindDataDictItemToCombobox("Barthel指数评价表_活动");
        BindDataDictItemToCombobox("Barthel指数评价表_穿衣");
        BindDataDictItemToCombobox("Barthel指数评价表_上下楼梯");
        BindDataDictItemToCombobox("Barthel指数评价表_洗澡");

        BindCombobox('#Barthel指数评价表_被评估人',
            '@Url.Action("GetAllItems", "Patient")',
            null,
            '编号',
            '姓名',
            null,
            true);

        $('#Barthel指数评价表_评估日期').datebox({ formatter: FormatHelper.FormatHelper });
        $('#Barthel指数评价表_评估日期').datebox('setValue', '@DateTime.Now.ToString("yyyy-MM-dd")');

        $("#Barthel指数评价表_大便, #Barthel指数评价表_小便, #Barthel指数评价表_修饰, #Barthel指数评价表_用厕, #Barthel指数评价表_进食, #Barthel指数评价表_转移, #Barthel指数评价表_活动, #Barthel指数评价表_穿衣, #Barthel指数评价表_上下楼梯, #Barthel指数评价表_洗澡")
            .combobox({
                onChange: ShowSum
            });

        $('#BADL_btnCancel')
            .bind('click',
                function() {
                    CloseEditor('#editorBADL');
                }
            );
    });

    function GetData() {
        return {
            大便: $('#Barthel指数评价表_大便').combobox('getText'),
            小便: $('#Barthel指数评价表_小便').combobox('getText'),
            修饰: $('#Barthel指数评价表_修饰').combobox('getText'),
            用厕: $('#Barthel指数评价表_用厕').combobox('getText'),
            进食: $('#Barthel指数评价表_进食').combobox('getText'),
            转移: $('#Barthel指数评价表_转移').combobox('getText'),
            活动: $('#Barthel指数评价表_活动').combobox('getText'),
            穿衣: $('#Barthel指数评价表_穿衣').combobox('getText'),
            上下楼梯: $('#Barthel指数评价表_上下楼梯').combobox('getText'),
            洗澡: $('#Barthel指数评价表_洗澡').combobox('getText'),
            总分: -1,
            被评估人: $('#Barthel指数评价表_被评估人').combobox('getText'),
            评估日期: $('#Barthel指数评价表_评估日期').datebox('getText'),
            康复护士: $('#Barthel指数评价表_康复护士').textbox('getText')
        };
    }

    function ShowSum() {
        const data = GetData();
        const url = '@Url.Action("GetSum", "BADL")';

        $.ajax({
            type: "POST",
            url: url,
            async: false,//否则会不同步
            data: { item: data }, //和 Action 参数要匹配
            success: function(result) {
                $('#Barthel指数评价表_总分').text(`总分：${result}`);
            },
            dataType: "json"
        });


    }
</script>

@if (Model != null)
{
    <script>
        window.previousId = -1;
        window.nextId = -1;
        $(function() { ShowData(`@Url.Action("GetSingleItem", "BADL")/${@ViewBag.CurrentId}`); });

        function ShowData(url) {
            $.ajax({
                type: "POST",
                url: url,
                success: function(data) {
                    const item = data.Item;

                    $('#Barthel指数评价表_大便').combobox('setText', item.大便);
                    $('#Barthel指数评价表_小便').combobox('setText', item.小便);
                    $('#Barthel指数评价表_修饰').combobox('setText', item.修饰);
                    $('#Barthel指数评价表_用厕').combobox('setText', item.用厕);
                    $('#Barthel指数评价表_进食').combobox('setText', item.进食);
                    $('#Barthel指数评价表_转移').combobox('setText', item.转移);
                    $('#Barthel指数评价表_活动').combobox('setText', item.活动);
                    $('#Barthel指数评价表_穿衣').combobox('setText', item.穿衣);
                    $('#Barthel指数评价表_上下楼梯').combobox('setText', item.上下楼梯);
                    $('#Barthel指数评价表_洗澡').combobox('setText', item.洗澡);

                    $('#Barthel指数评价表_被评估人').combobox('setText', item.被评估人);
                    $('#Barthel指数评价表_评估日期').datebox('setText', FormatHelper.DateBoxFormatter(item.评估日期));
                    $('#Barthel指数评价表_康复护士').textbox('setText', item.康复护士);
                    
                    $('#Barthel指数评价表_总分').text(`总分：${item.总分}`);

                    window.previousId = data.PreviousId;
                    window.nextId = data.NextId;
                },
                error: function() {
                    Alert("错误", 'error', AlertType.Error);
                },
                dataType: "json"
            });
        };
    </script>
}