@model List<Student>
@{
    Layout = null;
}
<script>
    var url = '@Url.Action("GetList", "Student")';
    var columns = [
        [
            {
                field: 'Sno',
                title: '学号',
                width: 100,
                sortable: true
            },
            {
                field: 'Sname',
                title: '姓名',
                width: 100,
                sortable: true
            },
            {
                field: 'Ssex',
                title: '性别',
                width: 100,
                sortable: true
            },
            {
                field: 'Sage',
                title: '年龄',
                width: 100,
                sortable: true
            },
            {
                field: 'Sdept',
                title: '系',
                width: 100,
                sortable: true
            }
        ]
    ];

    var gridTitle = '学生记录';
    var gridSortName = 'Sno';
    var gridSortOrder = 'desc';

    function Delete(idName) {
        var rows = $('#grid').datagrid('getSelections');

        if (rows.length === 0) {
            Alert('错误', '请选择至少一条记录。', AlertType.Error);
        } else {
            Confirm('确认',
                '确认删除学生记录吗？',
                function () {
                    var url = '@Url.Action("Delete", "Student")';
                    var ids = [];

                    for (var i = 0; i < rows.length; i++) {
                        ids.push(rows[i][idName]);
                    }

                    $.ajax({
                        url: url,
                        type: 'POST',
                        data: JSON.stringify(ids),
                        contentType: 'application/json; charset=utf-8',
                        success: function () {
                            $('#grid').datagrid('reload');
                        }
                    });
                });
        }
    }

    function Add() {
        var url = '@Url.Action("Create", "Student")';

        ShowEditor(url, '添加学生记录');
    }

    function Edit() {
        var rows = $('#grid').datagrid('getSelections');

        if (rows.length === 0) {
            Alert('错误', '请先选择一条记录。', AlertType.Error);
        } else if (rows.length > 1) {
            Alert('错误', '请只选择一条记录。', AlertType.Error);
            return;
        } else {
            var id = rows[0].Id;
            var url = '@Url.Action("Edit", "Student")' + '/' + id;

            ShowEditor(url, '修改学生记录');
        }
    }

    function Details() {
        var rows = $('#grid').datagrid('getSelections');

        if (rows.length === 0) {
            Alert('错误', '请先选择一条记录。', AlertType.Error);
        } else if (rows.length > 1) {
            Alert('错误', '请只选择一条记录。', AlertType.Error);
            return;
        } else {
            var id = rows[0].Id;

            var url = '@Url.Action("Details", "Student")' + '/' + id;

            ShowEditor(url, "显示学生明细");
        }
    }

    function Search() {
        var queryData = {
            Sno: $('#SearchSno').textbox('getText'),
            Ssex: $('#SearchSsex').textbox('getText'),
            Sdept: ($('#SearchSdept').textbox('getText') === 'ALL') ? '' : $('#SearchSdept').textbox('getText')
        };

        BindGrid(url, columns, gridTitle, gridSortName, gridSortOrder, queryData);
    }

    function ClearSearch() {
        var queryData = {};

        BindGrid(url, columns, gridTitle, gridSortName, gridSortOrder, queryData);

        $('#SearchSno').textbox('clear');
        $('#SearchSsex').textbox('clear');
        $('#SearchSdept').textbox('clear');
    }

    //when page is loaded
    $(function () {
        BindGrid(url, columns, gridTitle, gridSortName, gridSortOrder, {}); //Show all records
    });


</script>
<table id="grid" style="height: 100%"></table>
<div id="tb" style="padding: 2px 5px;">
    <div>
        学号 <input id="SearchSno" class="easyui-textbox" style="width: 110px">
        性别 <input id="SearchSsex" class="easyui-textbox" style="width: 110px">
        系
        <select id="SearchSdept" class="easyui-combobox" style="width: 100px">
            <option value="ALL">ALL</option>
            <option value="MA">MA</option>
            <option value="CS">CS</option>
            <option value="IS">IS</option>
        </select>
        <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-search" onclick="Search()">搜索</a>
        <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-no" onclick="ClearSearch()">清空搜索条件</a>
    </div>
    <div>
        <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-add" plain="true" onclick="Add()">添加</a>
        <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-edit" plain="true" onclick="Edit()">编辑</a>
        <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-remove" plain="true" onclick="Delete('Sno')">删除</a>
        <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-no" plain="true" onclick="Details()">详细</a>
    </div>
</div>
<div id="editor" style="width:400px"></div>
